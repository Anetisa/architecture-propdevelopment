# architecture-propdevelopment
Задание к спринту 7 ("Как пройти аудит безопасности и соответствовать его требованиям")

Описание файлов репозитория:
- `PropDevelopment_С4_model.drawio.xml` - исходная диаграмма контейнеров
- `Task1/mindmap.drawio` - mindmap отражающий категории данных, которые использует компания, классы этих данных и соответствующие им риски ( решение задания 1)
- `Task2/IB.md`- проверочный лист для бизнес-систем компании (решение задания 2)
- `Task3/Context_model.drawio` - диаграмма контекста в модели С4
- `Task3/Container_model.drawio` - обновлённая диаграмма контейнеров (решение задания 3)
- `Task3/integration_requirements.md` - список требований для внешних интеграций (решение задания 3)
- `Task4/roles_list.md` - таблица со списком ролей (решение задания 4)
- `Task4/...` 
- `Task5/non-admin-api-allow.yaml` - файл с сетевыми политиками (решение задания 5)

# Кейс компании PropDevelopment

## О компании
PropDevelopment — это крупная строительная компания. Она входит в топ-3  застройщиков в стране и продолжает активно развиваться.   

PropDevelopment предоставляет клиентам услуги, которые связаны с покупкой недвижимости и обслуживанием жилых комплексов. В основном компания работает с частными клиентами. Их можно разделить на две категории:   
- Потенциальные покупатели жилья. Их мы будем называть «клиенты».
- Собственники, которые приобрели жильё у компании. Их так и будем называть — «собственники».

Клиентам компания предлагает такие IT-продукты:
- Онлайн-витрина для подбора и бронирования недвижимости из фонда PropDevelopment.
- Онлайн-тур — приложение, которое позволяет клиентам осмотреть жильё без посещения объекта недвижимости.
- Онлайн-сделка — приложение, которое позволяет проводить сделки по покупке недвижимости онлайн.   
 
Для собственников компания разработала мобильное приложение, которое упрощает взаимодействия с управляющей компанией. В приложении можно:
- Оплачивать услуги ЖКХ.
- Получать информацию от управляющей компании.
- Следить за текущим и капитальным ремонтом. Собственники могут просматривать актуальные данные о запланированных работах и изучать историю проведённых работ.
- Управлять «Умным домом». Например, можно управлять автоматикой в жилом помещении и на этажах, а ещё контролировать устройство, которое запирает квартиру.

## Текущее состояние архитектуры

У компании доменная структура. Каждый домен отвечает за часть бизнеса и состоит из ряда продуктовых команд. Всего в PropDevelopment четыре домена:
- **Группа сервисов для продаж.** Сюда входит пять приложений: витрина продаж, client-tour-app (приложение для онлайн-тура), client-mart-app (приложение для онлайн-сделки), client-crm-app (система для управления клиентскими данными) и client-mart-estate-app (приложение для управления данными о недвижимости). У всех приложений, кроме витрины, есть собственная база данных.
- **Группа сервисов ЖКУ.** Они отвечают за предоставление услуг собственникам. Сюда входит витрина, tenant-core-app (сервис для предоставления услуг) и его БД, а также CRM, которая управляет данными о собственниках, и её БД.
- **Финансы.** В этот домен входит система финансового учёта — accountant-service-1, а также её БД и служба каталогов.
- **Дата** — группа сервисов, которые отвечают за обработку данных. Сюда входит хранилище, BI и отчётность.

![](PropDevelopment_С4_model.png)

Группа сервисов для клиентов — самая сложная. Здесь такая логика взаимодействия с пользователем:
- Монолитное приложение позволяет частным клиентам осуществлять подбор и бронирование недвижимости.
- Каждое бронирование недвижимости может сопровождаться осмотром. Это может быть оффлайн посещение или онлайн-тур. Результаты осмотра фиксируются в IT-системах. При бронировании клиент указывает контактные данные — ФИО, телефон и электронную почту. Ещё он может заполнить расширенную форму. Данные из расширенной формы далее используются при проведении онлайн-сделки.
- По результатам бронирования клиент может принять решение о покупке квартиры. Для этого реализована функциональность онлайн-сделки. Это сложный технический и юридический процесс, который клиент может провести через IT-системы PropDevelopment. Для этого компания реализовала интеграцию с госорганами, которые отвечают за определённые этапы.   
   
## Инфраструктура

Большинство IT-продуктов развёрнуты на собственных серверах. Часть продуктов развёрнуты в гибриде. Для временного расширения мощностей на этапах доработки и тестирования команды могут использовать облачные ресурсы и управляемые сервисы.   
   
Сервисы компании развёрнуты в приватном облаке, имеется собственный ЦОД и используются мощности, арендованные у облачного провайдера.   
   
Для всех баз данных выполняется резервное копирование данных на глубину, которая необходима для восстановления данных.   
   
Доступ в систему для внешних пользователей (клиентов и собственников) осуществляется через межсетевой экран (firewall).

## Структура команд

Продуктовая команда состоит из двух команд: функциональной и операционной.   
   
**Функциональная команда** отвечает за разработку, развитие и поддержку IT-продуктов. Каждая функциональная команда состоит из:
- владельца продукта,
- бизнес-аналитиков,
- разработчиков,
- инженеров по эксплуатации.
- DevOps-инженера.

**Операционная команда** — использует IT-продукты, разработанные продуктовой командой, в операционной деятельности компании. Операционная команда состоит из менеджеров. Они обеспечивают эффективное использование и развитие продуктов.
   
Специалист по ИБ один на всю компанию. Недавно были изменения в составе руководителей IT-команд, из-за чего нарушился процесс передачи информации между командами. В какой-то момент стало понятно, что специалисту по ИБ передают не все решения и изменения. 

## Проблемы и потребности бизнеса

Глобально у компании две проблемы. 
   
**Нарушен контроль данных.** Есть несколько точек регистрации нового клиента, координации между этими точками нет. Внутренние потоки данных между IT-продуктами контролируются не системно. Ограничения по передаваемым данным в основном обусловлены бизнес-процессами между взаимодействующими IT-продуктами. Со стороны систем обработки данных нет ограничений на доступ к данным.
   
**Есть проблемы с API партнёров.** Партнёры — это системы управляющих компаний, которые позволяют собственникам оплачивать ЖКУ и следить за информацией о доме. Системы PropDevelopment используют API управляющих компаний без единых политик по безопасности и без системного контроля за передаваемыми данными. В ходе интеграций команды разработки не раз замечали, что:
- Контракты API содержат категории данных, которые явно предоставляют персональные данные.
- Некоторые контракты позволяют внешним пользователям выполнять действия и получать данные, к которым у них не должно быть доступа. Например, партнёр из одной управляющей компании может увидеть или изменить данные клиентов и жилищных комплексов, которые относятся к другой компании.
   
При этом компания собирается активно развивать сервисы для покупателей и жильцов. В том числе — за счёт партнёрских сервисов.   
   
В итоге PropDevelopment собирается провести комплексный аудит безопасности. Сейчас компания готовится к этому мероприятию. Аудит безопасности поможет решить описанные проблемы и закрыть потребности бизнеса: 
- **Повысить уровень удовлетворённости клиентов.** Компания столкнулась с жалобами клиентов: они видят в приложении ошибки, когда заходят в личный кабинет. Там иногда могут отображаться данные другого клиента — например, другое Ф. И. О. Аудит безопасности позволит найти источник проблемы и устранить её.
- **Компания не может расширять направление обработки данных.** Компания активно накапливает данные, которые можно «заставить работать», — извлечь из данных знания и реализовать новые сервисы. PropDevelopment планирует реализовать новые сервисы на базе BI-, ML- и AI-технологий. Сейчас проблема управления и хранения потоков данных блокирует реализацию новых продуктов, основанных на данных.
- **Отреагировать на инциденты и рыночные изменения.** Недавно у конкурента произошла утечка данных, которая активно обсуждалась в СМИ. Руководство PropDevelopment обеспокоено. Аудит безопасности должен помочь компании предотвратить подобные инциденты.
- **Проверить соответствие требованиям законодательства.** IT-ландшафт PropDevelopment активно развивался: появлялись новые интеграции с поставщиками услуг для продажи недвижимости и новые услуги для жильцов. Сейчас нет уверенности в том, что все текущие бизнес-процессы компании соответствуют законодательным нормам. Аудит позволит проверить, выполняет ли компания требования законодательства РФ, и предотвратить возможные штрафы.

# Задание

## Задача 1 (Разработка проверочного листа по безопасности данных)

Первым делом нужно разработать проверочный лист по безопасности данных. Сейчас это ключевая проблема компании и самое уязвимое место.   
Чтобы создать документ, выполните четыре шага.   

1. Проанализируйте диаграмму и описание системы PropDevelopment   
Классифицируйте данные, с которыми работает компания, по стандартам ISO/IEC 27001 и 27002. Распределите их по четырём категориям:
- публичные данные,
- внутренние данные,
- конфиденциальные данные,
- секретные данные.
   
2. Определите риски для каждой категории данных   

В каждой категории данных могут существовать следующие риски:
- утечка данных,
- потеря данных,
- искажение данных,
- некачественные данные,
- обесценивание данных.
   
3. Объясните, почему именно этот риск актуален для указанной категории данных
4. Дайте оценку каждому риску

В качестве шкалы используйте категории «незначительный-значительный-критический».

5. Визуализируйте результаты анализа в виде mindmap. (Для создания mindmap используйте draw.io)

_**Решение:**_  [Категории, классы и риски данных](Task1/mindmap.drawio)

## Задача 2 (Разработка и заполнение проверочного листа для бизнес-систем)
   
Теперь вам необходимо составить проверочный лист безопасности для бизнес-систем.
   
Для этого:
- **Проанализируйте схему и описание системы**. Идентифицируйте системы и изучите характер их работы с точки зрения безопасности.
- **Выберите, какие разделы включить в проверочный лист**, исходя из проблем и приоритетов компании. Подробно объясните свой выбор — это важная часть решения.
- **Оформите проверочный лист в виде Markdown-таблицы.** В таком формате и вам, и ревьюеру будет легче отслеживать изменения в решении. При составлении листа можете опираться на предоставленный шаблон. Заполните все поля проверочного листа, для которых достаточно данных.
   
_**Решение:**_  [Проверочный лист для бизнес-систем компании](Task2/IB.md)

## Задача 3 (Внешние интеграции)

PropDevelopment хочет расширить бизнес-функции для собственников и жильцов. Компания планирует добавить в систему новые сервисы «Умный дом». Эти сервисы готов предоставить партнёр.
   
Вы согласовали техническое задание с бизнесом и выбрали две услуги для внедрения:
- **Интеллектуальный домофон.** Включает функции классического видеодомофона — открытие по звонку. Также есть возможность распознавать пользователей по биометрии (по лицу) и автоматически открывать дверь, если им разрешён доступ в дом.
- **Интеллектуальный шлагбаум.** Включает функции классического управления шлагбаумом и автоматически открывает доступ, если распознаёт номера автомобилей, которым въезд разрешён.
   
Новые сервисы должны быть доступны через текущее мобильное приложение, которое используют собственники.

**Что нужно сделать:**
- **Подготовьте диаграмму контекста в модели С4.** Она должна отражать контекст, в котором будут работать новые бизнес-функции.
- **Доработайте [диаграмму контейнеров PropDevelopment](PropDevelopment_С4_model.drawio.xml).** Отразите на ней изменения, которые вы предлагаете сделать в ландшафте систем кампании в связи с внедрением новых бизнес-функций.
- **Сформируйте список требований, которым должны удовлетворить внешние интеграции.** Для этого:
	- опишите требования к безопасности,
	- выделите протоколы аутентификации и авторизации,
	- опишите, как будет организовано взаимодействие между системами предприятия и внешней платформой.

_**Решение:**_
- [Диаграмма контекста в модели С4](Task3/Context_model.drawio) 
- [Обновлённая диаграмма контейнеров](Task3/Container_model.drawio)
- [Cписок требований для внешних интеграций](Task3/integration_requirements.md)

## Задача 4 (Защита доступа к кластеру Kubernetes)

В этом задании вы поработаете над решением технической задачи. Вам необходимо организовать ролевой доступ к Kubernetes для пользователей кластера.   
   
Вот контекст и факты о ролевой модели:
- Большинство бизнес-сервисов разворачивается в среде Kubernetes. Необходимо ограничить доступ к управлению кластером для различных групп пользователей.
- Необходимо защитить кластер с помощью предоставления привилегированных действий (например, просмотра секретов) для определённых групп пользователей.
- Кроме привилегированных групп пользователей, необходимо выделить ещё минимум две группы пользователей. У первой группы есть право только на просмотр ресурсов кластера. Вторая другая группа пользователей может настраивать кластер.
- Необходимо разграничить доступ к ресурсам кластера, исходя из организационной структуры компании.

**Что нужно сделать:**
- Поднимите пустой Minikube. 
- Определите все роли и их полномочия при работе с Kubernetes. Заполните таблицу: укажите там роли, их полномочия и группы пользователей, которые им соответствуют.
- Подготовьте скрипты для создания пользователей. Рекомендуем создать не менее двух пользователей.
- Подготовьте скрипты, чтобы создать роли. Они должны соответствовать ролям из вашей таблицы.
- Подготовьте скрипты, чтобы связать пользователей с ролями.

_**Решение:**_

- [Таблица со списком ролей](Task4/roles_list.md)` 
- [](Task4/...)
- ...

## Задача 5 (Управление трафиком внутри кластера Kubertnetes)

В этом задании вам нужно разграничить трафик между сервисами, которые развёрнуты в кластере Kubernetes:   
- Вам необходимо добавить новый сервис. В терминах Kubernetes это под (pod). При этом нужно запретить другим подам с ним взаимодействовать.
- Необходимо изолировать трафик к новому сервису от других подов.

**Что нужно сделать:**
1. В кластере, внутри одного namespace, вам необходимо развернуть четыре сервиса. В качестве самого сервиса используйте образ Nginx
2. Назначьте метки для сервисов

Метки выполняют функцию ролей для сервиса:
- front-end
- back-end-api
- admin-front-end
- admin-back-end-api

3. Создайте сетевые политики

Настройте сетевые политики так, чтобы разделить трафик между сервисами API (admin-back-end-api, back-end-api) и сервисами, которые используют их UI (front-end, admin-front-end).
   
Таким образом, сетевые политики должны разрешить сетевой трафик в обе стороны между парой сервисов front-end и back-end-api, а также admin-front-end и admin-back-end-api.
   
Сохраните сетевую политику в файл `non-admin-api-allow.yaml`. Затем примените сетевую политику.
   
Когда настроите и примените сетевые политики, проверьте, что трафик есть между сервисами, для которых он разрешён, но его нет между сервисами, для которых он запрещён.

_**Решение:**_ [Файл с сетевыми политиками](Task5/non-admin-api-allow.yaml)